# Структура проекта MCP AI Ассистент

## 📁 Обзор структуры

Проект организован по принципу разделения ответственности (Separation of Concerns) с четким разделением на модули и компоненты.

## 🗂️ Детальное описание

### Корневая директория

```
MCP/
├── main.py                    # 🚀 Точка входа приложения
├── app.py                     # 🌐 FastAPI приложение и API эндпоинты
├── models.py                  # 📋 Pydantic модели данных
├── llm_client.py              # 🤖 Клиент для работы с LLM
├── mcp_client.py              # 🔌 Клиент для работы с MCP серверами
├── requirements.txt           # 📦 Зависимости Python
├── Dockerfile                 # 🐳 Docker конфигурация
├── docker-compose.yml         # 🐳 Docker Compose (базовая)
├── docker-compose-full.yml    # 🐳 Docker Compose (полная)
├── .gitignore                 # 🚫 Игнорируемые файлы Git
└── README.md                  # 📖 Основная документация
```

### 📁 auth/ - Аутентификация и авторизация

```
auth/
├── __init__.py
├── ad_auth.py            # 🔐 Active Directory аутентификация
├── admin_auth.py         # 👑 Админ аутентификация
├── middleware.py         # 🛡️ Middleware для авторизации
└── session_manager.py    # 🍪 Управление сессиями
```

**Назначение**: Обеспечивает безопасность и управление доступом к системе.

**Ключевые компоненты**:
- `ad_auth.py` - интеграция с Active Directory
- `admin_auth.py` - специальная аутентификация для администраторов
- `middleware.py` - проверка прав доступа к API
- `session_manager.py` - управление пользовательскими сессиями

### 📁 config/ - Конфигурация системы

```
config/
├── __init__.py
├── config_manager.py     # ⚙️ Менеджер конфигурации
└── llm_config.py         # 🤖 Конфигурация LLM провайдеров
```

**Назначение**: Централизованное управление настройками системы.

**Ключевые компоненты**:
- `config_manager.py` - загрузка и сохранение конфигурации
- `llm_config.py` - настройки для различных LLM провайдеров

### 📁 llm_providers/ - LLM провайдеры

```
llm_providers/
├── __init__.py
├── base_provider.py      # 🏗️ Базовый класс провайдера
├── openai_provider.py    # 🧠 OpenAI провайдер
├── anthropic_provider.py # 👤 Anthropic Claude провайдер
├── google_provider.py    # 🔍 Google Gemini провайдер
├── ollama_provider.py    # 🖥️ Ollama провайдер
└── provider_factory.py   # 🏭 Фабрика провайдеров
```

**Назначение**: Абстракция для работы с различными LLM провайдерами.

**Ключевые компоненты**:
- `base_provider.py` - общий интерфейс для всех провайдеров
- `*_provider.py` - конкретные реализации провайдеров
- `provider_factory.py` - создание экземпляров провайдеров

### 📁 mcp_servers/ - MCP серверы

```
mcp_servers/
├── __init__.py
├── jira_server.py        # 📋 Jira MCP сервер
├── gitlab_server.py      # 🔀 GitLab MCP сервер
├── atlassian_server.py   # 📄 Confluence MCP сервер
└── ldap_server.py        # 👥 LDAP MCP сервер
```

**Назначение**: Интеграция с внешними системами через MCP протокол.

**Ключевые компоненты**:
- Каждый сервер реализует стандартный интерфейс
- Поддержка инструментов (tools) для каждой системы
- Условная загрузка (можно отключать через конфигурацию)

### 📁 analyzers/ - Анализаторы

```
analyzers/
├── __init__.py
└── code_analyzer.py      # 🔍 Анализатор кода
```

**Назначение**: Анализ и обработка различных типов данных.

### 📁 templates/ - HTML шаблоны

```
templates/
├── index.html            # 🏠 Главная страница
├── login.html            # 🔐 Страница входа
└── admin.html            # ⚙️ Админ-панель
```

**Назначение**: Пользовательский интерфейс веб-приложения.

### 📁 static/ - Статические файлы

```
static/
└── (CSS, JS, изображения)
```

**Назначение**: Статические ресурсы для веб-интерфейса.

### 📁 tests/ - Тесты

```
tests/
├── test_ldap_toggle.py      # 🧪 Тест отключения LDAP
├── test_llm_admin.py        # 🧪 Тест админ-панели LLM
├── test_llm_interaction.py  # 🧪 Тест взаимодействия с LLM
└── test_llm_providers.py    # 🧪 Тест LLM провайдеров
```

**Назначение**: Автоматизированное тестирование функциональности.

### 📁 docs/ - Документация

```
docs/
├── README.md             # 📖 Основная документация
├── LLM_PROVIDERS.md      # 🤖 Документация по LLM провайдерам
├── MCP_SETUP.md          # 🔧 Настройка MCP
└── PROJECT_STRUCTURE.md  # 📁 Структура проекта (этот файл)
```

**Назначение**: Техническая документация и руководства.

### 📁 scripts/ - Скрипты

```
scripts/
├── start.bat             # 🪟 Запуск на Windows
└── start.sh              # 🐧 Запуск на Linux/Mac
```

**Назначение**: Скрипты для удобного запуска приложения.

### 📁 config_files/ - Файлы конфигурации

```
config_files/
├── app_config.json.example    # 📋 Пример конфигурации
├── app_config.json            # ⚙️ Основная конфигурация
├── admin_config.json          # 👑 Конфигурация админа
└── python_ldap-*.whl          # 📦 Python LDAP пакет
```

**Назначение**: Файлы конфигурации и дополнительные пакеты.

## 🔄 Потоки данных

### 1. Запрос пользователя
```
Пользователь → templates/ → app.py → llm_client.py → llm_providers/
```

### 2. Обработка с инструментами
```
LLM → mcp_client.py → mcp_servers/ → Внешние системы
```

### 3. Аутентификация
```
Запрос → auth/middleware.py → auth/ad_auth.py → Active Directory
```

## 🏗️ Архитектурные принципы

### 1. Разделение ответственности
- Каждый модуль отвечает за свою область
- Четкие интерфейсы между модулями
- Минимальные зависимости

### 2. Конфигурируемость
- Все настройки в `config_files/`
- Возможность отключения компонентов
- Гибкая настройка провайдеров

### 3. Расширяемость
- Легко добавлять новые LLM провайдеры
- Простое добавление MCP серверов
- Модульная архитектура

### 4. Тестируемость
- Отдельные тесты для каждого компонента
- Мокирование внешних зависимостей
- Автоматизированное тестирование

## 🚀 Развертывание

### Локальная разработка
```bash
python main.py
```

### Docker
```bash
docker-compose up -d
```

### Продакшн
```bash
# Настройка конфигурации
cp config_files/app_config.json.example config_files/app_config.json
# Редактирование настроек
# Запуск
python main.py
```

## 🔧 Разработка

### Добавление нового LLM провайдера
1. Создать класс в `llm_providers/`
2. Наследоваться от `BaseLLMProvider`
3. Добавить в `provider_factory.py`
4. Обновить конфигурацию

### Добавление нового MCP сервера
1. Создать класс в `mcp_servers/`
2. Реализовать методы `get_tools()` и `call_tool()`
3. Добавить в `mcp_client.py`
4. Обновить админ-панель

### Добавление нового API эндпоинта
1. Добавить в `app.py`
2. Создать модель в `models.py`
3. Добавить тесты в `tests/`
4. Обновить документацию

## 📊 Метрики и мониторинг

- Логирование через стандартный Python logging
- Health check эндпоинты для каждого сервиса
- Метрики производительности в админ-панели
- Отслеживание ошибок и исключений

## 🔒 Безопасность

- JWT токены для аутентификации
- Middleware для проверки прав доступа
- Шифрование паролей и API ключей
- Валидация входных данных через Pydantic
- CORS настройки для веб-интерфейса
